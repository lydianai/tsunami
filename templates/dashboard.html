<!DOCTYPE html>
<html lang="tr" data-theme="cyan">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSUNAMI - Kontrol Paneli</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/themes.css">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <style>
        :root, [data-theme="cyan"] {
            --bg-void: #020408;
            --bg-deep: #040810;
            --bg-panel: rgba(8, 16, 24, 0.85);
            --bg-glass: rgba(12, 24, 36, 0.6);
            --bg-card: rgba(10, 20, 30, 0.9);
            --border-glow: rgba(0, 180, 255, 0.3);
            --border-subtle: rgba(0, 120, 180, 0.15);
            --text-bright: #e8f4ff;
            --text-normal: #a0c0d8;
            --text-dim: #506070;
            --accent-primary: #00b4ff;
            --accent-secondary: #00ff9d;
            --accent-warning: #ffaa00;
            --accent-danger: #ff3355;
            --accent-purple: #8855ff;
            --hud-green: #00ff88;
            --hud-cyan: #00e5ff;
            --hud-amber: #ffcc00;
        }
        /* F-35 KOKPIT TEMASI - SIYAH BEYAZ NEON */
        [data-theme="cockpit-bw"] {
            --bg-void: #000000;
            --bg-deep: #050505;
            --bg-panel: rgba(5, 5, 5, 0.98);
            --bg-glass: rgba(10, 10, 10, 0.9);
            --bg-card: rgba(8, 8, 8, 0.98);
            --border-glow: rgba(255, 255, 255, 0.5);
            --border-subtle: rgba(255, 255, 255, 0.15);
            --text-bright: #ffffff;
            --text-normal: #e0e0e0;
            --text-dim: #888888;
            --accent-primary: #ffffff;
            --accent-secondary: #e0e0e0;
            --accent-warning: #ffdd00;
            --accent-danger: #ff2222;
            --accent-purple: #cccccc;
            --hud-green: #00ff00;
            --hud-cyan: #ffffff;
            --hud-amber: #ffdd00;
        }
        [data-theme="cockpit-bw"] header, [data-theme="cockpit-bw"] .header { background: rgba(0,0,0,0.98) !important; border-color: rgba(255,255,255,0.3) !important; }
        [data-theme="cockpit-bw"] h1, [data-theme="cockpit-bw"] h2 { color: #fff !important; text-shadow: 0 0 15px rgba(255,255,255,0.5) !important; }
        [data-theme="cockpit-bw"] button { border-color: rgba(255,255,255,0.3) !important; color: #fff !important; }
        [data-theme="cockpit-bw"] button:hover { box-shadow: 0 0 15px rgba(255,255,255,0.3) !important; }
        [data-theme="cockpit-bw"] .card, [data-theme="cockpit-bw"] .panel { border-color: rgba(255,255,255,0.2) !important; background: rgba(0,0,0,0.9) !important; }
        [data-theme="cockpit-bw"] nav, [data-theme="cockpit-bw"] .nav-panel { background: rgba(0,0,0,0.98) !important; }
        [data-theme="cockpit-bw"] .nav-item:hover, [data-theme="cockpit-bw"] .nav-item.active { background: rgba(255,255,255,0.1) !important; }
        [data-theme="cockpit-bw"] input, [data-theme="cockpit-bw"] select, [data-theme="cockpit-bw"] textarea { background: rgba(0,0,0,0.8) !important; border-color: rgba(255,255,255,0.3) !important; color: #fff !important; }


        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-void);
            color: var(--text-normal);
            min-height: 100vh;
        }

        .main { padding: 20px; }

        /* Baslik */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .header h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-bright);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .header-actions { display: flex; gap: 10px; }

        /* Butonlar */
        .btn {
            padding: 10px 18px;
            border: 1px solid var(--border-glow);
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-glass);
            color: var(--text-normal);
        }

        .btn:hover {
            background: rgba(0, 180, 255, 0.15);
            border-color: var(--accent-primary);
            color: var(--text-bright);
            box-shadow: 0 0 15px rgba(0, 180, 255, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, rgba(0, 180, 255, 0.3), rgba(0, 100, 200, 0.3));
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, rgba(0, 180, 255, 0.5), rgba(0, 100, 200, 0.5));
            color: var(--text-bright);
            box-shadow: 0 0 20px rgba(0, 180, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-glass);
            border-color: var(--border-subtle);
        }

        /* Istatistik Kartlari */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 18px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--accent-primary);
            opacity: 0.5;
        }

        .stat-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 180, 255, 0.1);
        }

        .stat-card .label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 700;
        }

        .stat-card.wifi::before { background: var(--accent-primary); }
        .stat-card.wifi .value { color: var(--accent-primary); }

        .stat-card.bt::before { background: var(--accent-purple); }
        .stat-card.bt .value { color: var(--accent-purple); }

        .stat-card.baz::before { background: var(--hud-green); }
        .stat-card.baz .value { color: var(--hud-green); }

        .stat-card.iot::before { background: var(--accent-warning); }
        .stat-card.iot .value { color: var(--accent-warning); }

        .stat-card.zafiyet::before { background: var(--accent-danger); }
        .stat-card.zafiyet .value { color: var(--accent-danger); }

        .stat-card.alarm::before { background: var(--hud-amber); }
        .stat-card.alarm .value { color: var(--hud-amber); }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) { .grid-2 { grid-template-columns: 1fr; } }

        /* Kartlar */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            overflow: hidden;
        }

        .card-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 180, 255, 0.03);
        }

        .card-header h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-primary);
        }

        .card-body { padding: 18px; }

        /* Tablo */
        .table-wrap { max-height: 300px; overflow-y: auto; }

        table { width: 100%; border-collapse: collapse; }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-subtle);
        }

        th {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            font-weight: 500;
            position: sticky;
            top: 0;
            background: var(--bg-card);
        }

        td { font-size: 12px; }

        tr:hover { background: rgba(0, 180, 255, 0.05); }

        /* Sinyal Cubugu */
        .signal-bar {
            width: 50px;
            height: 4px;
            background: rgba(0, 120, 180, 0.2);
            border-radius: 2px;
        }

        .signal-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        .signal-fill.high { background: var(--hud-green); box-shadow: 0 0 5px var(--hud-green); }
        .signal-fill.mid { background: var(--accent-warning); box-shadow: 0 0 5px var(--accent-warning); }
        .signal-fill.low { background: var(--accent-danger); box-shadow: 0 0 5px var(--accent-danger); }

        /* Etiketler */
        .badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.yuksek { background: rgba(255, 51, 85, 0.2); color: var(--accent-danger); border: 1px solid rgba(255, 51, 85, 0.3); }
        .badge.orta { background: rgba(255, 170, 0, 0.2); color: var(--accent-warning); border: 1px solid rgba(255, 170, 0, 0.3); }
        .badge.dusuk { background: rgba(0, 255, 157, 0.2); color: var(--hud-green); border: 1px solid rgba(0, 255, 157, 0.3); }

        /* Arac Grid */
        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }

        .tool-item {
            padding: 10px;
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .tool-item:hover {
            border-color: var(--border-glow);
            background: rgba(0, 180, 255, 0.1);
        }

        .tool-item .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .tool-item .dot.active {
            background: var(--hud-green);
            box-shadow: 0 0 8px var(--hud-green);
        }

        .tool-item .dot.inactive {
            background: var(--accent-danger);
            box-shadow: 0 0 8px var(--accent-danger);
        }

        /* Ilerleme Cubugu */
        .progress-bar {
            display: none;
            padding: 14px 18px;
            background: rgba(0, 180, 255, 0.1);
            border: 1px solid rgba(0, 180, 255, 0.2);
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
            gap: 12px;
        }

        .progress-bar.active { display: flex; }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-subtle);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .progress-text {
            color: var(--accent-primary);
            font-size: 12px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(2, 4, 8, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 30px rgba(0, 180, 255, 0.1);
        }

        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 180, 255, 0.03);
        }

        .modal-header h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--accent-primary);
            letter-spacing: 1px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
            line-height: 1;
        }

        .modal-close:hover { color: var(--accent-danger); }

        .modal-body { padding: 20px; }

        /* Form */
        .form-group { margin-bottom: 18px; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            color: var(--text-bright);
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px rgba(0, 180, 255, 0.15);
        }

        .form-group input::placeholder { color: var(--text-dim); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 2px; }

        /* Bildirim */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 14px 20px;
            background: var(--bg-panel);
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .notification.success { border-color: var(--hud-green); }
        .notification.success::before {
            content: '';
            width: 8px; height: 8px;
            background: var(--hud-green);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--hud-green);
        }

        .notification.error { border-color: var(--accent-danger); }
        .notification.error::before {
            content: '';
            width: 8px; height: 8px;
            background: var(--accent-danger);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-danger);
        }

        .notification.warning { border-color: var(--accent-warning); }
        .notification.warning::before {
            content: '';
            width: 8px; height: 8px;
            background: var(--accent-warning);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-warning);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <main class="main">
        <div class="header">
            <h2>Kontrol Paneli</h2>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="yenile()">Yenile</button>
                <button class="btn btn-primary" onclick="tumTara()">Tum Taramalari Baslat</button>
            </div>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="spinner"></div>
            <span class="progress-text" id="progressText">Tarama yapiliyor...</span>
        </div>

        <div class="stats-grid">
            <div class="stat-card wifi">
                <div class="label">WiFi Aglari</div>
                <div class="value" id="statWifi">0</div>
            </div>
            <div class="stat-card bt">
                <div class="label">Bluetooth Cihazlar</div>
                <div class="value" id="statBt">0</div>
            </div>
            <div class="stat-card baz">
                <div class="label">Baz Istasyonlari</div>
                <div class="value" id="statBaz">0</div>
            </div>
            <div class="stat-card iot">
                <div class="label">IoT Cihazlar</div>
                <div class="value" id="statIot">0</div>
            </div>
            <div class="stat-card zafiyet">
                <div class="label">Zafiyetler</div>
                <div class="value" id="statZafiyet">0</div>
            </div>
            <div class="stat-card alarm">
                <div class="label">Alarmlar</div>
                <div class="value" id="statAlarm">0</div>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>WiFi Aglari</h3>
                    <button class="btn btn-secondary" onclick="wifiTara()">Tara</button>
                </div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>SSID</th>
                                    <th>BSSID</th>
                                    <th>Kanal</th>
                                    <th>Sinyal</th>
                                    <th>Guvenlik</th>
                                </tr>
                            </thead>
                            <tbody id="wifiTable">
                                <tr><td colspan="5" style="text-align:center;color:var(--text-dim)">Veri yok</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>Bluetooth Cihazlar</h3>
                    <button class="btn btn-secondary" onclick="btTara()">Tara</button>
                </div>
                <div class="card-body">
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Cihaz Adi</th>
                                    <th>MAC Adresi</th>
                                    <th>Kategori</th>
                                </tr>
                            </thead>
                            <tbody id="btTable">
                                <tr><td colspan="3" style="text-align:center;color:var(--text-dim)">Veri yok</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <h3>Guvenlik Araclari</h3>
                </div>
                <div class="card-body">
                    <div class="tool-grid" id="toolGrid"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>API Durumu</h3>
                    <button class="btn btn-secondary" onclick="apiModal()">Ayarlar</button>
                </div>
                <div class="card-body">
                    <div class="tool-grid" id="apiGrid">
                        <div class="tool-item"><span class="dot inactive" id="apiWigle"></span>Wigle.net</div>
                        <div class="tool-item"><span class="dot inactive" id="apiOpenCell"></span>OpenCellID</div>
                        <div class="tool-item"><span class="dot inactive" id="apiShodan"></span>Shodan</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- API Modal -->
    <div class="modal" id="apiModalDiv">
        <div class="modal-content">
            <div class="modal-header">
                <h3>API Anahtarlari</h3>
                <button class="modal-close" onclick="closeModal('apiModalDiv')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Wigle API Adi</label>
                    <input type="text" id="wigleName" placeholder="API adi girin">
                </div>
                <div class="form-group">
                    <label>Wigle API Token</label>
                    <input type="password" id="wigleToken" placeholder="API token girin">
                </div>
                <div class="form-group">
                    <label>OpenCellID API Anahtari</label>
                    <input type="password" id="opencellKey" placeholder="API anahtari girin">
                </div>
                <div class="form-group">
                    <label>Shodan API Anahtari</label>
                    <input type="password" id="shodanKey" placeholder="API anahtari girin">
                </div>
                <button class="btn btn-primary" onclick="apiKaydet()" style="width:100%">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Port Tarama Modal -->
    <div class="modal" id="portModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Port Tarama</h3>
                <button class="modal-close" onclick="closeModal('portModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Hedef IP / Alan Adi</label>
                    <input type="text" id="portHedef" placeholder="192.168.1.1 veya ornek.com">
                </div>
                <div class="form-group">
                    <label>Port Araligi</label>
                    <input type="text" id="portAralik" placeholder="1-1000" value="1-1000">
                </div>
                <button class="btn btn-primary" onclick="portTara()" style="width:100%">Taramayi Baslat</button>
            </div>
        </div>
    </div>

    <!-- Zafiyet Tarama Modal -->
    <div class="modal" id="zafiyetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Zafiyet Tarama</h3>
                <button class="modal-close" onclick="closeModal('zafiyetModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Hedef IP / Alan Adi</label>
                    <input type="text" id="zafiyetHedef" placeholder="192.168.1.1 veya ornek.com">
                </div>
                <button class="btn btn-primary" onclick="zafiyetTara()" style="width:100%">Taramayi Baslat</button>
            </div>
        </div>
    </div>

    <script>
        // Sesli Bildirim Sistemi - Web Speech API
        function sesliUyari(mesaj) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(mesaj);
                utterance.lang = 'tr-TR';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                const voices = speechSynthesis.getVoices();
                const turkceVoice = voices.find(v => v.lang.startsWith('tr'));
                if (turkceVoice) utterance.voice = turkceVoice;
                speechSynthesis.speak(utterance);
            }
        }
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
        }

        const socket = io();

        socket.on('connect', () => console.log('Baglanti kuruldu'));
        socket.on('tarama_durumu', (d) => {
            if(d.durum === 'baslatildi') showProgress(d.tip + ' taraniyor...');
            else hideProgress();
        });
        socket.on('tarama_sonuc', (d) => {
            hideProgress();
            if(d.tip === 'wifi') updateWifiTable(d.sonuclar);
            else if(d.tip === 'bluetooth') updateBtTable(d.sonuclar);
            loadStats();
            sesliUyari('Tarama tamamlandi');
        });
        socket.on('port_sonuc', (d) => {
            hideProgress();
            bildirimGoster('Port taramasi tamamlandi: ' + d.sonuclar.length + ' acik port', 'success');
        });
        socket.on('zafiyet_sonuc', (d) => {
            hideProgress();
            bildirimGoster('Zafiyet taramasi tamamlandi: ' + d.sonuclar.length + ' zafiyet', 'warning');
            loadStats();
        });

        document.addEventListener('DOMContentLoaded', () => { loadStats(); loadWifi(); loadBt(); });

        async function loadStats() {
            try {
                const r = await fetch('/api/durum');
                const d = await r.json();
                document.getElementById('statWifi').textContent = d.istatistikler.wifi;
                document.getElementById('statBt').textContent = d.istatistikler.bluetooth;
                document.getElementById('statBaz').textContent = d.istatistikler.baz;
                document.getElementById('statIot').textContent = d.istatistikler.iot;
                document.getElementById('statZafiyet').textContent = d.istatistikler.zafiyet;
                document.getElementById('statAlarm').textContent = d.istatistikler.alarm;

                document.getElementById('apiWigle').className = 'dot ' + (d.api_durumu.wigle ? 'active' : 'inactive');
                document.getElementById('apiOpenCell').className = 'dot ' + (d.api_durumu.opencellid ? 'active' : 'inactive');
                document.getElementById('apiShodan').className = 'dot ' + (d.api_durumu.shodan ? 'active' : 'inactive');

                let toolHtml = '';
                for(let [name, status] of Object.entries(d.araclar)) {
                    toolHtml += '<div class="tool-item"><span class="dot ' + (status ? 'active' : 'inactive') + '"></span>' + name + '</div>';
                }
                document.getElementById('toolGrid').innerHTML = toolHtml;
            } catch(e) {
                console.error('Durum yuklenemedi:', e);
            }
        }

        async function loadWifi() {
            try {
                const r = await fetch('/api/wifi/liste');
                const d = await r.json();
                updateWifiTable(d);
            } catch(e) {
                console.error('WiFi listesi yuklenemedi:', e);
            }
        }

        async function loadBt() {
            try {
                const r = await fetch('/api/bluetooth/liste');
                const d = await r.json();
                updateBtTable(d);
            } catch(e) {
                console.error('Bluetooth listesi yuklenemedi:', e);
            }
        }

        function updateWifiTable(data) {
            const tbody = document.getElementById('wifiTable');
            if(!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-dim)">Veri yok</td></tr>';
                return;
            }
            tbody.innerHTML = data.slice(0, 15).map(w => {
                const sinyal = w.sinyal_yuzde || w.sinyal || 0;
                const sClass = sinyal >= 70 ? 'high' : sinyal >= 40 ? 'mid' : 'low';
                return '<tr><td>' + (w.ssid || '&lt;Gizli&gt;') + '</td><td style="font-family:monospace;font-size:11px">' + (w.bssid || '-') + '</td><td>' + (w.kanal || '-') + '</td><td><div class="signal-bar"><div class="signal-fill ' + sClass + '" style="width:' + sinyal + '%"></div></div></td><td>' + (w.sifreleme || 'Acik') + '</td></tr>';
            }).join('');
        }

        function updateBtTable(data) {
            const tbody = document.getElementById('btTable');
            if(!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;color:var(--text-dim)">Veri yok</td></tr>';
                return;
            }
            tbody.innerHTML = data.slice(0, 15).map(b => '<tr><td>' + (b.ad || b.cihaz_adi || 'Bilinmeyen') + '</td><td style="font-family:monospace;font-size:11px">' + (b.mac || b.mac_adresi || '-') + '</td><td>' + (b.kategori || 'Diger') + '</td></tr>').join('');
        }

        function wifiTara() { showProgress('WiFi taraniyor...'); socket.emit('tarama_baslat', {tip: 'wifi'}); }
        function btTara() { showProgress('Bluetooth taraniyor...'); socket.emit('tarama_baslat', {tip: 'bluetooth'}); }
        function tumTara() { wifiTara(); setTimeout(btTara, 2000); }
        function yenile() { loadStats(); loadWifi(); loadBt(); bildirimGoster('Veriler guncellendi', 'success'); }

        function portTaraModal() { document.getElementById('portModal').classList.add('active'); }
        function zafiyetTaraModal() { document.getElementById('zafiyetModal').classList.add('active'); }
        function apiModal() { document.getElementById('apiModalDiv').classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function portTara() {
            const hedef = document.getElementById('portHedef').value;
            const portlar = document.getElementById('portAralik').value;
            if(!hedef) { bildirimGoster('Hedef giriniz', 'error'); return; }
            closeModal('portModal');
            showProgress('Port taramasi yapiliyor...');
            socket.emit('port_tara', {hedef: hedef, portlar: portlar});
        }

        function zafiyetTara() {
            const hedef = document.getElementById('zafiyetHedef').value;
            if(!hedef) { bildirimGoster('Hedef giriniz', 'error'); return; }
            closeModal('zafiyetModal');
            showProgress('Zafiyet taramasi yapiliyor...');
            socket.emit('zafiyet_tara', {hedef: hedef});
        }

        async function apiKaydet() {
            const wigleName = document.getElementById('wigleName').value;
            const wigleToken = document.getElementById('wigleToken').value;
            const opencellKey = document.getElementById('opencellKey').value;
            const shodanKey = document.getElementById('shodanKey').value;

            if(wigleName && wigleToken) await fetch('/api/ayarlar/api', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({servis:'wigle', anahtar:wigleName, secret:wigleToken})});
            if(opencellKey) await fetch('/api/ayarlar/api', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({servis:'opencellid', anahtar:opencellKey})});
            if(shodanKey) await fetch('/api/ayarlar/api', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({servis:'shodan', anahtar:shodanKey})});

            closeModal('apiModalDiv');
            loadStats();
            bildirimGoster('API anahtarlari kaydedildi', 'success');
        }

        function showProgress(text) {
            document.getElementById('progressBar').classList.add('active');
            document.getElementById('progressText').textContent = text;
        }
        function hideProgress() {
            document.getElementById('progressBar').classList.remove('active');
        }

        function bildirimGoster(mesaj, tip = 'success') {
            const div = document.createElement('div');
            div.className = 'notification ' + tip;
            div.innerHTML = '<span>' + mesaj + '</span>';
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 4000);

            // Sesli bildirim ekle
            if (tip === 'warning' || tip === 'error') {
                sesliUyari('Dikkat! ' + mesaj);
            } else if (tip === 'success') {
                sesliUyari(mesaj);
            }
        }

        document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', e => { if(e.target === m) m.classList.remove('active'); }));
    </script>
    <script src="/static/theme-switcher.js"></script>
    <script src="/static/theme-system.js"></script>
</body>
</html>
