# Shannon AI Pentester - Generic Vulnerability Response Playbook
# Fallback playbook for vulnerability types without specific handlers

id: shannon_generic_response
name: Shannon Generic Response
description: Generic automated response for Shannon-detected vulnerabilities
version: "1.0.0"
author: TSUNAMI Security Team
category: vulnerability_response
severity: medium
enabled: true

triggers:
  - type: shannon_finding
    conditions:
      exploited: true

variables:
  notification_channel: "#security-alerts"

steps:
  - id: log_detection
    name: Log Vulnerability Detection
    type: action
    action: audit_log
    params:
      event: shannon_vulnerability_detected
      severity: "{{ severity }}"
      message: "Shannon detected {{ vuln_type }} vulnerability at {{ location }}"
      details:
        finding_id: "{{ finding_id }}"
        vulnerability_type: "{{ vuln_type }}"
        method: "{{ method }}"
        location: "{{ location }}"

  - id: determine_severity
    name: Determine Response Level
    type: switch
    switch_variable: "{{ severity }}"
    switch_cases:
      critical:
        - id: critical_response
          name: Critical Alert
          type: action
          action: send_notification
          params:
            channel: "#security-critical"
            priority: critical
      high:
        - id: high_response
          name: High Priority Alert
          type: action
          action: send_notification
          params:
            channel: "{{ notification_channel }}"
            priority: high
      medium:
        - id: medium_response
          name: Standard Alert
          type: action
          action: send_notification
          params:
            channel: "{{ notification_channel }}"
            priority: medium
      low:
        - id: low_response
          name: Low Priority Log
          type: action
          action: audit_log
          params:
            event: low_priority_finding
            severity: low

  - id: enrich_finding
    name: Enrich Finding with Context
    type: action
    action: threat_intel_lookup
    params:
      indicators:
        - type: vulnerability
          value: "{{ vuln_type }}"
        - type: endpoint
          value: "{{ location }}"

  - id: check_existing_mitigations
    name: Check Existing Mitigations
    type: action
    action: check_controls
    params:
      endpoint: "{{ location }}"
      vuln_type: "{{ vuln_type }}"

  - id: apply_generic_protection
    name: Apply Generic Protection
    type: condition
    condition: "{{ waf_enabled == true }}"
    on_success: deploy_waf_protection
    on_failure: log_manual_required

  - id: deploy_waf_protection
    name: Deploy WAF Protection
    type: action
    action: waf_add_rule
    params:
      rule_type: "generic_{{ vuln_type }}"
      target_path: "{{ location }}"
      method: "{{ method }}"
      comment: "Shannon auto-protection - {{ finding_id }}"
    continue_on_error: true

  - id: log_manual_required
    name: Log Manual Action Required
    type: action
    action: audit_log
    params:
      event: manual_mitigation_required
      message: "WAF unavailable - manual mitigation needed for {{ finding_id }}"

  - id: create_remediation_ticket
    name: Create Remediation Ticket
    type: action
    action: create_ticket
    params:
      system: jira
      project: SEC
      priority: "{{ severity | title }}"
      title: "[SHANNON] {{ vuln_type | upper }} - {{ location }}"
      description: |
        ## Vulnerability Detected by Shannon AI Pentester

        ### Details
        | Field | Value |
        |-------|-------|
        | Type | {{ vuln_type }} |
        | Severity | {{ severity }} |
        | Location | {{ method }} {{ location }} |
        | Finding ID | {{ finding_id }} |
        | Verified | âœ… Exploited |

        ### Impact
        {{ impact | default('See Shannon report for details') }}

        ### Remediation Steps
        {{ remediation | default('Consult OWASP guidelines for this vulnerability type') }}

        ---
        *Auto-generated by TSUNAMI SOAR - Shannon Integration*
      labels: [shannon, "{{ vuln_type }}", security, verified]

  - id: update_metrics
    name: Update Security Metrics
    type: action
    action: metrics_increment
    params:
      metric: shannon_findings_processed
      labels:
        vuln_type: "{{ vuln_type }}"
        severity: "{{ severity }}"
        automated: true

  - id: final_status
    name: Update Incident Status
    type: action
    action: update_incident
    params:
      incident_id: "{{ incident_id }}"
      status: in_progress
      notes: "Automated response completed. Ticket created for remediation."

metadata:
  created_at: "2026-02-07"
  tags: [shannon, generic, automated-response]
